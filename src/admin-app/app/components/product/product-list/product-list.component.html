<div class="row">
    <div class="col-sm-8 title">
        <h1>Products</h1>
    </div>
    <div class="col-sm-4 top_right text-right" [ngClass]="{ 'hidden': bulkUploadView }">
        <input class="form-control txt_Search ng-untouched ng-pristine ng-valid" placeholder="search for product by name" [(ngModel)]="productName" (keyup)="getPage(1)" type="text">
    </div>
</div>
<div class="row" [ngClass]="{ 'hidden': bulkUploadView }">
    <div class="col-sm-12 text-right">
        <ul class="product_search row m-0 p-0">
            <li class="w-5">
                <select class="ddl_default form-control" [(ngModel)]="productStatus">
                    <option [ngValue]="productStatusDummy">Status</option>
                    <option [ngValue]="true">Active</option>
                    <option [ngValue]="false">Inactive</option>
                </select>
            </li>
            <li class="w-20">
                <angular2-multiselect [data]="places" [(ngModel)]="selectedPlaces" [settings]="placesSettings" (onSelect)="onPlaceSelect($event)" (onDeSelect)="onPlaceDeSelect($event)" (onSelectAll)="onPlaceSelectAll($event)" (onDeSelectAll)="onPlaceDeSelectAll($event)">
                </angular2-multiselect>

            </li>
            <li class="w-15">
                <angular2-multiselect [data]="categories" [(ngModel)]="selectedCategories" [settings]="categorySettings" (onSelect)="onCategorySelect($event)" (onDeSelect)="onCategoryDeSelect($event)" (onSelectAll)="onCategorySelectAll($event)" (onDeSelectAll)="onCategoryDeSelectAll($event)">
                </angular2-multiselect>

            </li>
            <li class="w-20">
                <angular2-multiselect [data]="subCategories" [(ngModel)]="selectedSubCategories" [settings]="subCategorySettings" (onSelect)="onSubCategorySelect($event)" (onDeSelect)="onSubCategoryDeSelect($event)" (onSelectAll)="onSubCategorySelectAll($event)" (onDeSelectAll)="onSubCategoryDeSelectAll($event)">
                </angular2-multiselect>
            </li>
            <li class="w-15">
                <select class="ddl_default w-100 form-control" [(ngModel)]="retailer">
                    <option [ngValue]="reatileDummy">Select Seller</option>
                    <option *ngFor="let option of retailers" [ngValue]="option">
                        {{option.businessName}}
                    </option>
                </select>
            </li>
            <li class="w-20">
                <a class="btn btn-default" (click)="getPage(1)">
                    <i class="fa fa-search"></i>
                </a>
                <a class="btn btn-default" routerLink="/product-add" routerLinkActive="retailer-add">+ Add a product</a>
            </li>
        </ul>
    </div>
</div>
<div class="spinner" [ngClass]="{ 'hidden': !loading }"></div>
<div class="col-sm-12 p-0 pt-3 pagination_align">
    <pagination-controls id='server' (pageChange)="getPage($event)"></pagination-controls>
</div>
<div class="backgroundWhite">
    <table class="table table-responsive"  sortable-table (sorted)="onSorted($event)">
        <thead>
            <tr>
                <th width="5%">
                    <input type="checkbox">
                </th>
                <th sortable-column="productStatus" width="7%">Status</th>
                <th sortable-column="retailerName" width="10%">Seller</th>
                <th sortable-column="productName" width="30%">Product name</th>
                <th sortable-column="brandName" width="10%">Brand</th>
                <th width="7%">Main image</th>
                <th width="8%">Product code</th>
                <th sortable-column="kalaPrice" width="6%">Kala price</th>
                <th sortable-column="quantity" width="6%">Available quantity</th>
                <th sortable-column="quantity" width="6%">Sold quantity</th>
                <th width="5%"></th>
            </tr>
        </thead>
        <tbody *ngFor="let product of products.content | paginate: { id: 'server', itemsPerPage: products.size, currentPage: products.number + 1 , totalItems: products.totalElements }">
            <tr>
                <td>
                    <input type="checkbox">
                </td>
                <td>{{product.productStatus?'Active': 'InActive'}}</td>
                <td>{{getSellerName(product.retailerName)}}</td>
                <td>
                    <a class="colorBlue" (click)="product.isCollapsed = !product.isCollapsed" [attr.aria-expanded]="!product.isCollapsed" aria-controls="collapseExample">
                        {{product.productName}}
                    </a>
                </td>
                <td>{{product.brandName}}</td>
                <td>
                    <img src="{{product.mainImage.imageUrl}}" *ngIf="product.mainImage" width="40">
                    <i class="fa fa-picture-o defaultUser colorGray py-2" *ngIf="!product.mainImage" width="40"></i>
                </td>
                <td>{{product.kalaUniqueId}}</td>
                <td>{{product.kalaPrice|currency}}</td>
                <td>{{product.quantity}}</td>
                <td>{{product.quantity}}</td>
                <td>

                    <div ngbDropdown class="">
                        <a class="" id="dropdown01" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" ngbDropdownToggle></a>
                        <div ngbDropdownMenu aria-labelledby="dropdown01">
                            <button class="dropdown-item" (click)="deactivate(product)">Activate/Deactivate</button>
                            <button class="dropdown-item" *ngIf="!bulkUploadView" (click)="delete(product)">Delete</button>
                            <button class="dropdown-item" *ngIf="!bulkUploadView" [routerLink]="['../product-edit', product.kalaUniqueId]">Edit Product</button>
                        </div>
                    </div>
                </td>
            </tr>
            <tr *ngIf="!product.isCollapsed">
                <td colspan="11">
                    <div class="card-body" id="collapseExample">
                        <table class="sub-table table" width="100">
                            <thead>
                                <tr>
                                    <th>
                                        <a class=" btn btn-default" (click)="deactivate(product)">{{product.productStatus?'deactivate':'activate'}}</a>
                                    </th>
                                    <th *ngIf="!bulkUploadView">
                                        <a class="btn btn-default" (click)="delete(product)">Delete</a>
                                    </th>
                                    <th colspan="2" class="text-right" *ngIf="!bulkUploadView">
                                        <a class="btn btn-default" [routerLink]="['../product-edit', product.kalaUniqueId]">Edit Product</a>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="colorlightGray" width="20%">Kala Place:</td>
                                    <td width="30%">{{product.productPlaceName}}</td>
                                    <td class="colorlightGray" width="20%">Product category:</td>
                                    <td width="30%">{{product.productCategoryName}}</td>
                                </tr>
                                <tr>
                                    <td class="colorlightGray">Product type:</td>
                                    <td>{{product.productTypeName}}</td>
                                    <td class="colorlightGray">Kala Product ID:</td>
                                    <td>{{product.kalaUniqueId}}</td>
                                </tr>
                                <tr>
                                    <td class="colorlightGray">Kala Unique ID:</td>
                                    <td>{{product.kalaUniqueId}}</td>
                                    <td class="colorlightGray">Product SKU code: </td>
                                    <td>{{product.productSkuCode}}</td>
                                </tr>
                                <tr>
                                    <td class="colorlightGray">Product UPC code: </td>
                                    <td>{{product.productUpcCode}}</td>
                                    <td class="colorlightGray">Retail price:</td>
                                    <td>{{product.retailPrice| currency}}</td>
                                </tr>
                                <tr>
                                    <td class="colorlightGray">Make a bid:</td>
                                    <td>Y</td>
                                    <td class="colorlightGray">Lowest “Make a bid” price:</td>
                                    <td>{{product.lowestPrice|currency}}</td>
                                </tr>
                                <tr>
                                    <td class="colorlightGray">Added date:</td>
                                    <td>{{product.createdDate| date:'fullDate'}}</td>
                                    <td class="colorlightGray">Product description:</td>
                                    <td>{{product.productDescription}}</td>
                                </tr>
                                <tr>
                                    <td class="colorlightGray">Special features:</td>
                                    <td>{{product.brandName}}</td>
                                    <td class="colorlightGray">Color/Finish:</td>
                                    <td>N/A</td>
                                </tr>
                                <tr>
                                    <td class="colorlightGray">Size:</td>
                                    <td> 20cm / 30cm / 40cm</td>
                                    <td class="colorlightGray">Size-fit category: </td>
                                    <td>N/A</td>
                                </tr>
                                <tr>
                                    <td class="colorlightGray">Size country: </td>
                                    <td>China</td>
                                    <td class="colorlightGray">Dimensions:</td>
                                    <td> 20cm x 20cm x 60cmH</td>
                                </tr>
                                <tr>
                                    <td class="colorlightGray">Weight: </td>
                                    <td>10 lbs</td>
                                    <td class="colorlightGray">Availability indicator:</td>
                                    <td> N/A</td>
                                </tr>
                                <tr>
                                    <td class="colorlightGray">Shipping profile:</td>
                                    <td>{{product.shipProfileName}}</td>
                                    <td class="colorlightGray">Other images:</td>
                                    <td>
                                        <img src="{{img.imageUrl}}" class="p-2" *ngFor="let img of product.otherImages" width="100">
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </td>
            </tr>

        </tbody>
    </table>
    <h3 *ngIf="products.totalElements == 0">No Products available</h3>
</div>